<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.goodsple.features.report.mapper.ReportMapper">

    <!-- Report ResultMap -->
    <resultMap id="ReportResultMap" type="com.goodsple.features.report.dto.request.Report">
        <id     property="reportId"            column="report_id"/>
        <result property="reporterId"         column="reporter_id"/>
        <result property="reportTargetUserId" column="report_target_user_id"/>
        <result property="targetType"         column="target_type"/>
        <result property="targetId"           column="target_id"/>
        <result property="reportStatus"       column="report_status"/>
        <result property="actionTaken"        column="action_taken"/>
        <result property="reportCreatedAt"    column="report_created_at"/>
        <result property="processedAt"        column="processed_at"/>
        <result property="reportDescription"  column="report_description"/>
    </resultMap>

    <!-- Insert Report -->
    <insert id="insertReport" parameterType="com.goodsple.features.report.dto.request.Report">
        INSERT INTO reports (
            reporter_id,
            report_target_user_id,
            target_type,
            target_id,
            report_status,
            action_taken,
            report_created_at,
            processed_at,
            report_description
        ) VALUES (
                     #{reporterId},
                     #{reportTargetUserId},
                     #{targetType},
                     #{targetId},
                     #{reportStatus},
                     #{actionTaken},
                     #{reportCreatedAt},
                     #{processedAt},
                     #{reportDescription}
                 )
    </insert>

    <!-- Select Report by ID -->
    <select id="selectReportById" parameterType="long" resultMap="ReportResultMap">
        SELECT
            report_id,
            reporter_id,
            report_target_user_id,
            target_type,
            target_id,
            report_status,
            action_taken,
            report_created_at,
            processed_at,
            report_description
        FROM reports
        WHERE report_id = #{reportId}
    </select>

    <!-- ReportReason ResultMap -->
    <resultMap id="ReportReasonResultMap" type="com.goodsple.features.report.dto.request.ReportReason">
        <id     property="reportReasonId"   column="report_reason_id"/>
        <result property="reportReasonText" column="report_reason_text"/>
    </resultMap>

    <!-- Insert Reason -->
    <insert id="insertReason" parameterType="com.goodsple.features.report.dto.request.ReportReason">
        INSERT INTO report_reasons (
            report_reason_id,
            report_reason_text
        ) VALUES (
                     #{reportReasonId},
                     #{reportReasonText}
                 )
    </insert>

    <!-- Select All Reasons -->
    <select id="selectAllReasons" resultMap="ReportReasonResultMap">
        SELECT
            report_reason_id,
            report_reason_text
        FROM report_reasons
    </select>

    <!-- Insert Reason Mapping -->
    <insert id="insertReasonMapping" parameterType="com.goodsple.features.report.dto.request.ReportReasonMapping">
        INSERT INTO report_reason_mapping (
            report_id,
            report_reason_id
        ) VALUES (
                     #{reportId},
                     #{reportReasonId}
                 )
    </insert>

    <!-- Select Reason IDs by Report -->
    <select id="selectReasonIdsByReport" parameterType="long" resultType="long">
        SELECT report_reason_id
        FROM report_reason_mapping
        WHERE report_id = #{reportId}
    </select>

</mapper>